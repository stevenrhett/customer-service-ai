---
alwaysApply: true
title: Architecture Guardrails
description: Prevent backend/frontend structure drift, enforce conventions and safety.
scope: this repo only
architecture guardrails
backend: FastAPI + LangGraph + Chroma. Keep routes thin, all business logic in app/services, agents in app/agents, chains in app/chains. No business logic in api/.
frontend: Next.js App Router. UI in src/components, API calls in src/lib/apiClient.ts, chat state in src/hooks/useChat.ts. Streaming via SSE; non-streaming fallback is allowed.
• No OpenAI or Bedrock API calls directly from React components. All API calls must go through src/lib/apiClient.ts.
• Config from app/config.py (backend) and src/lib/env.ts (frontend). Never hard-code secrets. Use .env.example placeholders only.
Coding standards
python: type hints, ruff+black, no print—use structured logging in utils/logging.py.
ts/react: strict TS, no any, no logic inside JSX components that belongs in hooks/lib.

Acceptance checks for any PR-sized refactor
• uvicorn backend.app.main:app --reload starts clean.
• /api/v1/chat (JSON) and /api/v1/chat/stream (SSE) both work.
• npm run lint && npm run typecheck && npm test all pass in frontend/.
• Do not touch venv/, .env, or commit secrets. Keep requirements*.txt deduped.
---
